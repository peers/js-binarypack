/*! binarypack.min.js build:0.0.7, production. Copyright(c) 2012 Eric Zhang <eric@ericzhang.com> MIT Licensed */(function(e){function n(){this._pieces=[],this._parts=[]}function i(e){this.index=0,this.blob=e,this.length=e.size,this.reader=new FileReader,this.reader.onload=s,this.reader.obj=this,this.callbacks=[],this.backReferences=[],this.stringBuffer="",this.codeBuffer=0,this.sizeBuffer=[],this.keyBuffer=[],this.genericBuffer=undefined}function s(){this.obj.callbacks.pop().call(this.obj,this.result)}function o(e){this.callbacks.pop().call(this,(new Float32Array(e))[0])}function u(e){this.callbacks.pop().call(this,(new Float64Array(e))[0])}function a(e){this.callbacks.pop().call(this,(new Uint8Array(e))[0])}function f(e){this.callbacks.pop().call(this,(new Uint16Array(e))[0])}function l(e){this.callbacks.pop().call(this,(new Uint32Array(e))[0])}function c(e){this.callbacks.pop().call(this,(new Int8Array(e))[0])}function h(e){this.callbacks.pop().call(this,(new Int16Array(e))[0])}function p(e){this.callbacks.pop().call(this,(new Int32Array(e))[0])}function d(e){e=(new Uint8Array(e))[0];if(e==255){var t=this.stringBuffer;return this.stringBuffer="",this.codeBuffer=0,this.callbacks.pop().call(this,t)}if(e<128)return this.codeBuffer=0,this.stringBuffer+=String.fromCharCode(e),this.read(1,d);if(e<224)return this.codeBuffer=(e&63)<<6,this.read(1,v);if(e<240)return this.codeBuffer=(e&31)<<12,this.read(2,v);if(e<248)return this.codeBuffer=(e&15)<<18,this.read(3,v);if(e<252)return this.codeBuffer=(e&7)<<18,this.read(4,v);this.codeBuffer=(e&3)<<30,this.read(5,v)}function v(e){e=new Uint8Array(e);for(var t=0;t<e.length;t++)this.codeBuffer|=(e[t]&127)<<(e.length-1-t)*6;this.stringBuffer+=String.fromCharCode(this.codeBuffer),this.codeBuffer=0,this.read(1,d)}function m(e){e=(new Float64Array(e))[0],this.callbacks.pop().call(this,new Date(e))}function g(e){this.genericBuffer={type:e},this.callbacks.push(y),this.read(1,d)}function y(e){this.genericBuffer.name=e,this.callbacks.push(b),this.read(8,u)}function b(e){this.genericBuffer.date=e,this.unpack(w)}function w(e){var t=this.genericBuffer.name,n=this.genericBuffer.date,i=this.genericBuffer.type;this.genericBuffer=undefined;var s=this.blob.slice(this.index,this.index+=e,i);r?this.callbacks.pop().call(this,new File([s],t,{type:i,lastModified:n})):(s.name=t,s.lastModifiedDate=new Date(n),this.callbacks.pop().call(this,s))}function E(e){this.genericBuffer=e,this.unpack(S)}function S(e){var t=this.genericBuffer;this.genericBuffer=undefined;var n=this.blob.slice(this.index,this.index+=e,t);this.callbacks.pop().call(this,n)}function x(e){this.read(e,T)}function T(e){this.callbacks.pop().call(this,e)}function N(e){this.genericBuffer={length:e},this.unpack(C)}function C(e){this.genericBuffer.offset=e,this.unpack(x)}function k(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Uint8Array(e,t,n))}function L(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Uint16Array(e,t,n/2))}function A(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Uint32Array(e,t,n/4))}function O(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Int8Array(e,t,n))}function M(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Int16Array(e,t,n/2))}function _(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Int32Array(e,t,n/4))}function D(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Float32Array(e,t,n/4))}function P(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Float64Array(e,t,n/8))}function H(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new DataView(e,t,n))}function B(e){this.callbacks.pop().call(this,this.backReferences[e])}function j(e){this.backReferences.push([]),e>0?(this.sizeBuffer.push(e),this.unpack(F)):this.callbacks.pop().call(this,this.backReferences.pop())}function F(e){this.backReferences[this.backReferences.length-1].push(e),--this.sizeBuffer[this.sizeBuffer.length-1]==0?(this.sizeBuffer.pop(),this.callbacks.pop().call(this,this.backReferences.pop())):this.unpack(F)}function I(e){this.backReferences.push({}),e>0?(this.sizeBuffer.push(e),this.callbacks.push(q),this.read(1,d)):this.callbacks.pop().call(this,this.backReferences.pop())}function q(e){this.keyBuffer.push(e),this.unpack(R)}function R(e){this.backReferences[this.backReferences.length-1][this.keyBuffer.pop()]=e,--this.sizeBuffer[this.sizeBuffer.length-1]==0?(this.sizeBuffer.pop(),this.callbacks.pop().call(this,this.backReferences.pop())):(this.callbacks.push(q),this.read(1,d))}function U(e){e=(new Uint8Array(e))[0];if(e>=240)return this.callbacks.pop().call(this,e&15);if(e>=224)return this.callbacks.pop().call(this,-((e&14)+1));switch(e){case 0:return this.callbacks.pop().call(this,null);case 1:return this.callbacks.pop().call(this,undefined);case 2:return this.callbacks.pop().call(this,!1);case 3:return this.callbacks.pop().call(this,!0);case 4:return this.read(4,o);case 5:return this.read(8,u);case 6:return this.read(1,a);case 7:return this.read(2,f);case 8:return this.read(4,l);case 9:return this.read(1,c);case 10:return this.read(2,h);case 11:return this.read(4,p);case 12:return this.read(1,d);case 13:return this.read(8,m);case 14:return this.callbacks.push(g),this.read(1,d);case 15:return this.callbacks.push(E),this.read(1,d);case 16:return this.unpack(x);case 17:return this.callbacks.push(k),this.unpack(N);case 18:return this.callbacks.push(L),this.unpack(N);case 19:return this.callbacks.push(A),this.unpack(N);case 20:return this.callbacks.push(O),this.unpack(N);case 21:return this.callbacks.push(M),this.unpack(N);case 22:return this.callbacks.push(_),this.unpack(N);case 23:return this.callbacks.push(D),this.unpack(N);case 24:return this.callbacks.push(P),this.unpack(N);case 25:return this.callbacks.push(H),this.unpack(N);case 26:return this.unpack(B);case 27:return this.unpack(j);case 28:return this.unpack(I)}}function z(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength,this.backReferences=[]}function W(){this.bufferBuilder=new n,this.backReferences=[]}function $(e){return X.set(e),V[0]}function J(e){return V[0]=e,V.buffer.slice(0)}function K(e){return V[0]=e,V[0]}function Y(e){return Q.set(e),G[0]}function Z(e){return G[0]=e,G.buffer.slice(0)}function et(e){return G[0]=e,G[0]}function rt(e){return tt.set(e),nt[0]}function it(e){return nt[0]=e,nt.buffer.slice(0)}function st(e){return nt[0]=e,nt[0]}function at(e){return ot.set(e),ut[0]}function ft(e){return ut[0]=e,ut.buffer.slice(0)}function lt(e){return ut[0]=e,ut[0]}function pt(e){return ct.set(e),ht[0]}function dt(e){return ht[0]=e,ht.buffer.slice(0)}function vt(e){return ht[0]=e,ht[0]}function yt(e){return mt.set(e),gt[0]}function bt(e){return gt[0]=e,gt.buffer.slice(0)}function wt(e){return gt[0]=e,gt[0]}function xt(e){return Et.set(e),St[0]}function Tt(e){return St[0]=e,St.buffer.slice(0)}function Nt(e){return St[0]=e,St[0]}function kt(e){return Ct.set(e),Ct[0]}function Lt(e){return Ct[0]=e,Ct.buffer.slice(0)}function At(e){return Ct[0]=e,Ct[0]}var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return(new Blob([new Uint8Array([])])).size===0}catch(e){return!0}}(),e.binaryFeatures=t,e.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder,n.prototype.append=function(e){typeof e=="number"?this._pieces.push(e):(this.flush(),this._parts.push(e))},n.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);t.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},n.prototype.getBuffer=function(){this.flush();if(t.useBlobBuilder){var e=new BlobBuilder;for(var n=0,r=this._parts.length;n<r;n++)e.append(this._parts[n]);return e.getBlob()}return new Blob(this._parts)},e.BinaryPack={unpack:function(e){var t=new z(e);return t.unpack()},blobUnpack:function(e,t){var n=new i(e);return n.unpack(t)},pack:function(e){var t=new W;t.pack(e);var n=t.getBuffer();return n}};var r=function(){try{new File(["foo"],"bar")}catch(e){return!1}return!0}();i.prototype.read=function(e,t){var n=this.blob.slice(this.index,this.index+=e);this.callbacks.push(t),this.reader.readAsArrayBuffer(n)},i.prototype.unpack=function(e){this.callbacks.push(e),this.read(1,U)},z.prototype.unpack=function(){var e=this.unpack_uint8();if(e>=240)return e&15;if(e>=224)return-((e&14)+1);switch(e){case 0:return null;case 1:return undefined;case 2:return!1;case 3:return!0;case 4:return this.unpack_float32();case 5:return this.unpack_float64();case 6:return this.unpack_uint8();case 7:return this.unpack_uint16();case 8:return this.unpack_uint32();case 9:return this.unpack_int8();case 10:return this.unpack_int16();case 11:return this.unpack_int32();case 12:return this.unpack_string();case 13:return this.unpack_date();case 14:return this.unpack_file();case 15:return this.unpack_blob();case 16:return this.unpack_raw(this.unpack());case 17:return this.unpack_uint8array();case 18:return this.unpack_uint16array();case 19:return this.unpack_uint32array();case 20:return this.unpack_int8array();case 21:return this.unpack_int16array();case 22:return this.unpack_int32array();case 23:return this.unpack_float32array();case 24:return this.unpack_float64array();case 25:return this.unpack_dataview();case 26:return this.backReferences[this.unpack()];case 27:return this.unpack_array();case 28:return this.unpack_map()}},z.prototype.unpack_uint8=function(){var e=this.read(1);return this.index++,kt(e)},z.prototype.unpack_uint16=function(){var e=this.read(2);return this.index+=2,yt(e)},z.prototype.unpack_uint32=function(){var e=this.read(4);return this.index+=4,at(e)},z.prototype.unpack_int8=function(){var e=this.read(1);return this.index++,xt(e)},z.prototype.unpack_int16=function(){var e=this.read(2);return this.index+=2,pt(e)},z.prototype.unpack_int32=function(){var e=this.read(4);return this.index+=4,rt(e)},z.prototype.unpack_float32=function(){var e=this.read(4);return this.index+=4,Y(e)},z.prototype.unpack_float64=function(){var e=this.read(8);return this.index+=8,$(e)},z.prototype.unpack_date=function(){var e=this.unpack_float64();return new Date(e)},z.prototype.unpack_file=function(){var e=this.unpack_string(),t=this.unpack_string(),n=this.unpack_float64(),i=this.unpack(),s=this.unpack_raw(i);if(r)return new File([s],t,{type:e,lastModified:n});var o=new Blob([s],{type:e});return o.name=t,o.lastModifiedDate=new Date(n),o},z.prototype.unpack_blob=function(){var e=this.unpack_string(),t=this.unpack(),n=this.unpack_raw(t);return new Blob([n],{type:e})},z.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},z.prototype.unpack_uint8array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Uint8Array(n,t,e)},z.prototype.unpack_uint16array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Uint16Array(n,t,e/2)},z.prototype.unpack_uint32array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Uint32Array(n,t,e/4)},z.prototype.unpack_int8array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Int8Array(n,t,e)},z.prototype.unpack_int16array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Int16Array(n,t,e/2)},z.prototype.unpack_int32array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Int32Array(n,t,e/4)},z.prototype.unpack_float32array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Float32Array(n,t,e/4)},z.prototype.unpack_float64array=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new Float64Array(n,t,e/8)},z.prototype.unpack_dataview=function(){var e=this.unpack(),t=this.unpack(),n=this.unpack_raw(this.unpack());return new DataView(n,t,e)},z.prototype.unpack_string=function(){var e=this.index,t="",n;while(this.dataView[e]!=255){if(this.dataView[e]<128){t+=String.fromCharCode(this.dataView[e]),e++;continue}if(this.dataView[e]<224){n=(this.dataView[e]&63)<<6|this.dataView[e+1]&127,t+=String.fromCharCode(n),e+=2;continue}if(this.dataView[e]<240){n=(this.dataView[e]&31)<<12|(this.dataView[e+1]&127)<<6|this.dataView[e+2]&127,t+=String.fromCharCode(n),e+=3;continue}if(this.dataView[e]<248){n=(this.dataView[e]&15)<<18|(this.dataView[e+1]&127)<<12|(this.dataView[e+1]&127)<<6|this.dataView[e+3]&127,t+=String.fromCharCode(n),e+=4;continue}if(this.dataView[e]<252){n=(this.dataView[e]&7)<<24|(this.dataView[e+1]&127)<<18|(this.dataView[e+2]&127)<<12|(this.dataView[e+3]&127)<<6|this.dataView[e+4]&127,t+=String.fromCharCode(n),e+=5;continue}n=(this.dataView[e+1]&3)<<30|(this.dataView[e]&127)<<24|(this.dataView[e+2]&127)<<18|(this.dataView[e+3]&127)<<12|(this.dataView[e+4]&127)<<6|this.dataView[e+5]&127,t+=String.fromCharCode(n),e+=6}return this.index=e+1,t},z.prototype.unpack_array=function(){var e=this.unpack(),t=[];this.backReferences.push(t);for(var n=0;n<e;n++)t.push(this.unpack());return this.backReferences.pop(),t},z.prototype.unpack_map=function(){var e={},t=this.unpack();this.backReferences.push(e);for(var n=0;n<t;n++){var r=this.unpack_string(),i=this.unpack();e[r]=i}return this.backReferences.pop(),e},z.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},W.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},W.prototype.pack=function(e){switch(typeof e){case"string":this.pack_string(e);break;case"number":lt(e)===e||st(e)===e?this.pack_integer(e):this.pack_double(e);break;case"boolean":e?this.bufferBuilder.append(Lt(3)):this.bufferBuilder.append(Lt(2));break;case"undefined":this.bufferBuilder.append(Lt(1));break;case"object":if(e!==null)return typeof e.toBinaryPack=="function"?this.bufferBuilder.append(e.toBinaryPack()):e.constructor==Object?this.pack_object(e):e instanceof Array?this.pack_array(e):e instanceof Date?this.pack_date(e):e instanceof Blob?e instanceof File?this.pack_file(e):this.pack_blob(e):e instanceof ArrayBuffer?this.pack_buffer(e):e.buffer instanceof ArrayBuffer?e instanceof Uint8Array?this.pack_uint8array(e):e instanceof Uint16Array?this.pack_uint16array(e):e instanceof Uint32Array?this.pack_uint32array(e):e instanceof Int8Array?this.pack_int8array(e):e instanceof Int16Array?this.pack_int16array(e):e instanceof Int32Array?this.pack_int32array(e):e instanceof Float32Array?this.pack_float32array(e):e instanceof Float64Array?this.pack_float64array(e):e instanceof DataView?this.pack_dataview(e):this.pack_object(e):this.pack_object(e);this.bufferBuilder.append(Lt(0))}},W.prototype.pack_date=function(e){this.bufferBuilder.append(Lt(13)),this.pack_raw_date(e)},W.prototype.pack_raw_date=function(e){var t=e.valueOf();this.pack_float64(t)},W.prototype.pack_file=function(e){this.bufferBuilder.append(Lt(14)),this.pack_raw_string(e.type),this.pack_raw_string(e.name),e.lastModifiedDate?this.pack_raw_date(e.lastModifiedDate):this.pack_float64(lastModified),this.pack(e.size),this.bufferBuilder.append(e)},W.prototype.pack_blob=function(e){this.bufferBuilder.append(Lt(15)),this.pack_raw_string(e.type),this.pack(e.size),this.bufferBuilder.append(e)},W.prototype.pack_buffer=function(e){this.bufferBuilder.append(Lt(16)),this.pack_raw_buffer(e)},W.prototype.pack_raw_buffer=function(e){this.pack(e.byteLength),this.bufferBuilder.append(e)},W.prototype.pack_raw_bufferview=function(e){this.pack(e.byteLength),this.pack(e.byteOffset),this.pack_raw_buffer(e.buffer)},W.prototype.pack_uint8array=function(e){this.bufferBuilder.append(Lt(17)),this.pack_raw_bufferview(e)},W.prototype.pack_uint16array=function(e){this.bufferBuilder.append(Lt(18)),this.pack_raw_bufferview(e)},W.prototype.pack_uint32array=function(e){this.bufferBuilder.append(Lt(19)),this.pack_raw_bufferview(e)},W.prototype.pack_int8array=function(e){this.bufferBuilder.append(Lt(20)),this.pack_raw_bufferview(e)},W.prototype.pack_int16array=function(e){this.bufferBuilder.append(Lt(21)),this.pack_raw_bufferview(e)},W.prototype.pack_int32array=function(e){this.bufferBuilder.append(Lt(22)),this.pack_raw_bufferview(e)},W.prototype.pack_float32array=function(e){this.bufferBuilder.append(Lt(23)),this.pack_raw_bufferview(e)},W.prototype.pack_float64array=function(e){this.bufferBuilder.append(Lt(24)),this.pack_raw_bufferview(e)},W.prototype.pack_dataview=function(e){this.bufferBuilder.append(Lt(25)),this.pack_raw_bufferview(e)},W.prototype.pack_string=function(e){this.bufferBuilder.append(Lt(12)),this.pack_raw_string(e)},W.prototype.pack_raw_string=function(e){this.bufferBuilder.append(e),this.bufferBuilder.append(Lt(255))},W.prototype.pack_array=function(e){this.bufferBuilder.append(Lt(27)),this.pack(e.length),this.backReferences.push(e);var t;for(var n=0;n<e.length;n++){if((t=this.backReferences.indexOf(e[n]))!=-1){this.bufferBuilder.append(Lt(26)),this.pack(t);continue}this.pack(e[n])}this.backReferences.pop()},W.prototype.pack_object=function(e){this.bufferBuilder.append(Lt(28)),this.pack(Object.keys(e).length),this.backReferences.push(e);var t;for(var n in e){if(!e.hasOwnProperty(n))continue;this.pack_raw_string(n);if((t=this.backReferences.indexOf(e[n]))!=-1){this.bufferBuilder.append(Lt(26)),this.pack(t);continue}this.pack(e[n])}this.backReferences.pop()},W.prototype.pack_integer=function(e){e>=0?e<=15?this.bufferBuilder.append(Lt(240|e)):At(e)==e?(this.bufferBuilder.append(Lt(6)),this.bufferBuilder.append(Lt(e))):wt(e)==e?(this.bufferBuilder.append(Lt(7)),this.bufferBuilder.append(bt(e))):lt(e)==e&&(this.bufferBuilder.append(Lt(8)),this.bufferBuilder.append(ft(e))):e>=-16?(e=-e-1,this.bufferBuilder.append(Lt(224|e))):Nt(e)==e?(this.bufferBuilder.append(Lt(9)),this.bufferBuilder.append(Tt(e))):vt(e)==e?(this.bufferBuilder.append(Lt(10)),this.bufferBuilder.append(dt(e))):st(e)==e&&(this.bufferBuilder.append(Lt(11)),this.bufferBuilder.append(it(e)))},W.prototype.pack_double=function(e){et(e)==e?(this.bufferBuilder.append(Lt(4)),this.pack_float32(e)):(this.bufferBuilder.append(Lt(5)),this.pack_float64(e))},W.prototype.pack_uint8=function(e){this.bufferBuilder.append(uInt8ToBuffer(e))},W.prototype.pack_uint16=function(e){this.bufferBuilder.append(uInt16ToBuffer(e))},W.prototype.pack_uint32=function(e){this.bufferBuilder.append(uInt32ToBuffer(e))},W.prototype.pack_int8=function(e){this.bufferBuilder.append(Tt(e))},W.prototype.pack_int16=function(e){this.bufferBuilder.append(dt(e))},W.prototype.pack_int32=function(e){this.bufferBuilder.append(it(e))},W.prototype.pack_float32=function(e){this.bufferBuilder.append(Z(e))},W.prototype.pack_float64=function(e){this.bufferBuilder.append(J(e))};var X=new Uint8Array(8),V=new Float64Array(X.buffer),Q=new Uint8Array(4),G=new Float32Array(Q.buffer),tt=new Uint8Array(4),nt=new Int32Array(tt.buffer),ot=new Uint8Array(4),ut=new Uint32Array(ot.buffer),ct=new Uint8Array(2),ht=new Int16Array(ct.buffer),mt=new Uint8Array(2),gt=new Uint16Array(mt.buffer),Et=new Uint8Array(1),St=new Int8Array(Et.buffer),Ct=new Uint8Array(1)})(this)