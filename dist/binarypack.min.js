/*! binarypack.min.js build:0.0.7, production. Copyright(c) 2012 Eric Zhang <eric@ericzhang.com> MIT Licensed */(function(e){function n(){this._pieces=[],this._parts=[]}function o(e){var t=this.that,n=t.times.indexOf(e.data);t.times.splice(n,1),t.callbacks.splice(n,1)[0].apply(t.those.splice(n,1)[0],t.args.splice(n,1)[0])}function u(){this.worker=new Worker(s),this.worker.onmessage=o,this.worker.that=this,this.callbacks=[],this.those=[],this.args=[],this.times=[]}function f(e){this.index=0,this.callbacks=[],e instanceof ArrayBuffer?(this.view=new Uint8Array(e),this.start=0,this.end=e.byteLength):(this.blob=e,this.start=0,this.end=0,this.view=undefined,this._read={n:undefined,cb:undefined,type:undefined},this.reader=new FileReader,this.reader.onload=l,this.reader.obj=this),this.backReferences=[],this.stringBuffer="",this.codeBuffer=0,this.sizeBuffer=[],this.keyBuffer=[],this.genericBuffer=undefined}function l(){this.obj.view=new Uint8Array(this.result),this.obj.read(this.obj._read.n,this.obj._read.cb,this.obj._read.type)}function c(e){this.callbacks.pop().call(this,lt(e))}function h(e){this.callbacks.pop().call(this,st(e))}function p(e){this.callbacks.pop().call(this,It(e))}function d(e){this.callbacks.pop().call(this,Ot(e))}function v(e){this.callbacks.pop().call(this,wt(e))}function m(e){this.callbacks.pop().call(this,Ht(e))}function g(e){this.callbacks.pop().call(this,Nt(e))}function y(e){this.callbacks.pop().call(this,vt(e))}function b(e){e=e[0];if(e==255){var t=this.stringBuffer;return this.stringBuffer="",this.codeBuffer=0,this.callbacks.pop().call(this,t)}if(e<128)return this.codeBuffer=0,this.stringBuffer+=String.fromCharCode(e),this.read(1,b);if(e<224)return this.codeBuffer=(e&63)<<6,this.read(1,w);if(e<240)return this.codeBuffer=(e&31)<<12,this.read(2,w);if(e<248)return this.codeBuffer=(e&15)<<18,this.read(3,w);if(e<252)return this.codeBuffer=(e&7)<<18,this.read(4,w);this.codeBuffer=(e&3)<<30,this.read(5,w)}function w(e){for(var t=0;t<e.length;t++)this.codeBuffer|=(e[t]&127)<<(e.length-1-t)*6;this.stringBuffer+=String.fromCharCode(this.codeBuffer),this.codeBuffer=0,this.read(1,b)}function E(e){this.callbacks.pop().call(this,new Date(st(e)))}function S(e){this.genericBuffer={type:e},this.callbacks.push(x),this.read(1,b)}function x(e){this.genericBuffer.name=e,this.callbacks.push(T),this.read(8,h)}function T(e){this.genericBuffer.date=e,this.unpack(N)}function N(e){this.read(e,C,"blob")}function C(e){var t=this.genericBuffer.name,n=this.genericBuffer.date,i=this.genericBuffer.type;this.genericBuffer=undefined,r?this.callbacks.pop().call(this,new File([e],t,{type:i,lastModified:n})):(e=new Blob([e],{type:i}),e.name=t,e.lastModifiedDate=new Date(n),e.lastModified=n,this.callbacks.pop().call(this,e))}function k(e){this.genericBuffer=e,this.unpack(L)}function L(e){this.read(e,A,"blob")}function A(e){var t=this.genericBuffer;this.genericBuffer=undefined,e=new Blob([e],{type:t}),this.callbacks.pop().call(this,e)}function O(e){this.read(e,M,"arraybuffer")}function M(e){this.callbacks.pop().call(this,e)}function _(e){this.genericBuffer={length:e},this.unpack(D)}function D(e){this.genericBuffer.offset=e,this.unpack(O)}function P(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Uint8Array(e,t,n))}function H(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Uint16Array(e,t,n/2))}function B(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Uint32Array(e,t,n/4))}function j(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Int8Array(e,t,n))}function F(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Int16Array(e,t,n/2))}function I(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Int32Array(e,t,n/4))}function q(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Float32Array(e,t,n/4))}function R(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new Float64Array(e,t,n/8))}function U(e){var t=this.genericBuffer.offset,n=this.genericBuffer.length;this.callbacks.pop().call(this,new DataView(e,t,n))}function z(e){this.callbacks.pop().call(this,this.backReferences[e])}function W(e){var t=[];t._index=0,this.backReferences.push(t),e>0?(this.sizeBuffer.push(e),this.unpack(X)):this.callbacks.pop().call(this,this.backReferences.pop())}function X(e){var t=this.backReferences[this.backReferences.length-1];e!=i&&(t[t._index]=e),t._index++,t._index==this.sizeBuffer[this.sizeBuffer.length-1]?(delete t._index,this.sizeBuffer.pop(),this.callbacks.pop().call(this,this.backReferences.pop())):this.unpack(X)}function V(e){this.backReferences.push({}),e>0?(this.sizeBuffer.push(e),this.callbacks.push($),this.read(1,b)):this.callbacks.pop().call(this,this.backReferences.pop())}function $(e){this.keyBuffer.push(e),this.unpack(J)}function J(e){this.backReferences[this.backReferences.length-1][this.keyBuffer.pop()]=e,--this.sizeBuffer[this.sizeBuffer.length-1]==0?(this.sizeBuffer.pop(),this.callbacks.pop().call(this,this.backReferences.pop())):(this.callbacks.push($),this.read(1,b))}function K(e){this.genericBuffer={hash:e},this.unpack(Q)}function Q(e){this.genericBuffer.start=e,e==0?this.unpack(G):this.unpack(Z)}function G(e){this.genericBuffer.metadata=e,this.unpack(Y)}function Y(e){this.genericBuffer.total=e,this.unpack(Z)}function Z(e){this.genericBuffer.end=e,this.read(e-this.genericBuffer.start,et,"blob")}function et(e){var t=new Ut(e,this.genericBuffer.start,this.genericBuffer.end,this.genericBuffer.hash,this.genericBuffer.metadata,this.genericBuffer.total);this.genericBuffer=undefined,this.callbacks.pop().call(this,t)}function tt(e){e=e[0];if(e>=240)return this.callbacks.pop().call(this,e&15);if(e>=224)return this.callbacks.pop().call(this,-((e&14)+1));switch(e){case 0:return this.callbacks.pop().call(this,null);case 1:return this.callbacks.pop().call(this,undefined);case 2:return this.callbacks.pop().call(this,!1);case 3:return this.callbacks.pop().call(this,!0);case 4:return this.read(4,c);case 5:return this.read(8,h);case 6:return this.read(1,p);case 7:return this.read(2,d);case 8:return this.read(4,v);case 9:return this.read(1,m);case 10:return this.read(2,g);case 11:return this.read(4,y);case 12:return this.read(1,b);case 13:return this.read(8,E);case 14:return this.callbacks.push(S),this.read(1,b);case 15:return this.callbacks.push(k),this.read(1,b);case 16:return this.unpack(O);case 17:return this.callbacks.push(P),this.unpack(_);case 18:return this.callbacks.push(H),this.unpack(_);case 19:return this.callbacks.push(B),this.unpack(_);case 20:return this.callbacks.push(j),this.unpack(_);case 21:return this.callbacks.push(F),this.unpack(_);case 22:return this.callbacks.push(I),this.unpack(_);case 23:return this.callbacks.push(q),this.unpack(_);case 24:return this.callbacks.push(R),this.unpack(_);case 25:return this.callbacks.push(U),this.unpack(_);case 26:return this.unpack(z);case 27:return this.unpack(W);case 28:return this.unpack(V);case 29:return this.callbacks.pop().call(this,i);case 30:return this.unpack(K)}}function nt(){this.bufferBuilder=new n,this.backReferences=[]}function st(e){return rt.set(e),it[0]}function ot(e){it[0]=e;var t=it.buffer.slice(0);return a.after(0,$t,this,[t]),t}function ut(e){return it[0]=e,it[0]}function lt(e){return at.set(e),ft[0]}function ct(e){ft[0]=e;var t=ft.buffer.slice(0);return a.after(0,$t,this,[t]),t}function ht(e){return ft[0]=e,ft[0]}function vt(e){return pt.set(e),dt[0]}function mt(e){dt[0]=e;var t=dt.buffer.slice(0);return a.after(0,$t,this,[t]),t}function gt(e){return dt[0]=e,dt[0]}function wt(e){return yt.set(e),bt[0]}function Et(e){bt[0]=e;var t=bt.buffer.slice(0);return a.after(0,$t,this,[t]),t}function St(e){return bt[0]=e,bt[0]}function Nt(e){return xt.set(e),Tt[0]}function Ct(e){Tt[0]=e;var t=Tt.buffer.slice(0);return a.after(0,$t,this,[t]),t}function kt(e){return Tt[0]=e,Tt[0]}function Ot(e){return Lt.set(e),At[0]}function Mt(e){At[0]=e;var t=At.buffer.slice(0);return a.after(0,$t,this,[t]),t}function _t(e){return At[0]=e,At[0]}function Ht(e){return Dt.set(e),Pt[0]}function Bt(e){Pt[0]=e;var t=Pt.buffer.slice(0);return a.after(0,$t,this,[t]),t}function jt(e){return Pt[0]=e,Pt[0]}function It(e){return Ft.set(e),Ft[0]}function qt(e){Ft[0]=e;var t=Ft.buffer.slice(0);return a.after(0,$t,this,[t]),t}function Rt(e){return Ft[0]=e,Ft[0]}function Ut(e,t,n,r,i,s){this.data=e,this.start=t,this.end=n,this.hash=r,this.total=s,this.metadata=i}function zt(e,t,n){this.blob=e,this.index=0,this.complete=0,this.hash=t,this.metadata=n}function Wt(){this.result=[],this.index=0,this.complete=0,this.buffer={pointers:[],chunks:[]}}function $t(e){Vt.postMessage(e,[e])}var t={};t.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),t.useArrayBufferView=!t.useBlobBuilder&&function(){try{return(new Blob([new Uint8Array([])])).size===0}catch(e){return!0}}(),e.binaryFeatures=t,e.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder,n.prototype.append=function(e){typeof e=="number"?this._pieces.push(e):(this.flush(),this._parts.push(e))},n.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);t.useArrayBufferView||(e=e.buffer),setTimeout($t,0,e.buffer),this._parts.push(e),this._pieces=[]}},n.prototype.getBuffer=function(){this.flush();if(t.useBlobBuilder){var e=new BlobBuilder;for(var n=0,r=this._parts.length;n<r;n++)e.append(this._parts[n]);return e.getBlob()}return new Blob(this._parts)};var r=function(){try{new File(["foo"],"bar")}catch(e){return!1}return!0}(),i={},s=URL.createObjectURL(new Blob(["function postIt(time){postMessage(time);}self.onmessage = function(e){setTimeout(postIt,e.data,e.data);};"],{type:"text/javascript"}));u.prototype.after=function(e,t,n,r){this.times.push(e),this.callbacks.push(t),this.those.push(n),this.args.push(r),this.worker.postMessage(e)},u.prototype.destroy=function(){this.worker.terminate(),this.callbacks=[],this.those=[],this.args=[],this.times=[]};var a=new u;f.prototype.refresh=function(){$t(this.view.buffer),this.view=undefined},f.prototype.doRecursively=function(e,t){try{e.call(this,t)}catch(n){e.call(this,t)}},f.prototype.read=function(e,t,n){var r=this.index,i=this.index+e;if(this.blob&&n=="blob"){this.index=i,this.index==this.end&&($t(this.view.buffer),this.view=undefined),this.doRecursively(t,this.blob.slice(r,i));return}if(this.view)if(this.end<i){$t(this.view.buffer);var s=this.blob.slice(r,Math.max(r+BinaryPack.maxRAM,i));this.end=r+s.size,this.start=r,this._read.cb=t,this._read.n=e,this._read.type=n,this.reader.readAsArrayBuffer(s)}else{this.index=i;switch(n){case"arraybuffer":var o=this.view.buffer.slice(r-this.start,i-this.start);this.doRecursively(t,o);break;case"blob":var o=this.view.buffer.slice(r-this.start,i-this.start);Xt(o,t,this);break;default:var o=[],u=i-this.start;for(var a=r-this.start;a<u;a++)o.push(this.view[a]);this.doRecursively(t,o)}}else{var s=this.blob.slice(r,Math.max(r+BinaryPack.maxRAM,i));this.end=r+s.size,this.start=r,this._read.cb=t,this._read.n=e,this._read.type=n,this.reader.readAsArrayBuffer(s)}},f.prototype.unpack=function(e){this.callbacks.push(e),this.read(1,tt)},nt.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},nt.prototype.pack=function(e){switch(typeof e){case"string":this.pack_string(e);break;case"number":St(e)===e||gt(e)===e?this.pack_integer(e):this.pack_double(e);break;case"boolean":e?this.bufferBuilder.append(qt(3)):this.bufferBuilder.append(qt(2));break;case"undefined":this.bufferBuilder.append(qt(1));break;case"object":if(e!==null)return typeof e.toBinaryPack=="function"?this.bufferBuilder.append(e.toBinaryPack()):e.constructor==Object?this.pack_object(e):e instanceof Array?this.pack_array(e):e instanceof Date?this.pack_date(e):e instanceof Ut?this.pack_chunk(e):e instanceof Blob?e instanceof File?this.pack_file(e):this.pack_blob(e):e instanceof ArrayBuffer?this.pack_buffer(e):e.buffer instanceof ArrayBuffer?e instanceof Uint8Array?this.pack_uint8array(e):e instanceof Uint16Array?this.pack_uint16array(e):e instanceof Uint32Array?this.pack_uint32array(e):e instanceof Int8Array?this.pack_int8array(e):e instanceof Int16Array?this.pack_int16array(e):e instanceof Int32Array?this.pack_int32array(e):e instanceof Float32Array?this.pack_float32array(e):e instanceof Float64Array?this.pack_float64array(e):e instanceof DataView?this.pack_dataview(e):this.pack_object(e):this.pack_object(e);this.bufferBuilder.append(qt(0))}},nt.prototype.pack_date=function(e){this.bufferBuilder.append(qt(13)),this.pack_raw_date(e)},nt.prototype.pack_raw_date=function(e){var t=e.valueOf();this.pack_float64(t)},nt.prototype.pack_file=function(e){this.bufferBuilder.append(qt(14)),this.pack_raw_string(e.type),this.pack_raw_string(e.name),e.lastModifiedDate?this.pack_raw_date(e.lastModifiedDate):this.pack_float64(e.lastModified),this.pack(e.size),this.bufferBuilder.append(e)},nt.prototype.pack_blob=function(e){this.bufferBuilder.append(qt(15)),this.pack_raw_string(e.type),this.pack(e.size),this.bufferBuilder.append(e)},nt.prototype.pack_buffer=function(e){this.bufferBuilder.append(qt(16)),this.pack_raw_buffer(e)},nt.prototype.pack_raw_buffer=function(e){this.pack(e.byteLength),this.bufferBuilder.append(e)},nt.prototype.pack_raw_bufferview=function(e){this.pack(e.byteLength),this.pack(e.byteOffset),this.pack_raw_buffer(e.buffer)},nt.prototype.pack_uint8array=function(e){this.bufferBuilder.append(qt(17)),this.pack_raw_bufferview(e)},nt.prototype.pack_uint16array=function(e){this.bufferBuilder.append(qt(18)),this.pack_raw_bufferview(e)},nt.prototype.pack_uint32array=function(e){this.bufferBuilder.append(qt(19)),this.pack_raw_bufferview(e)},nt.prototype.pack_int8array=function(e){this.bufferBuilder.append(qt(20)),this.pack_raw_bufferview(e)},nt.prototype.pack_int16array=function(e){this.bufferBuilder.append(qt(21)),this.pack_raw_bufferview(e)},nt.prototype.pack_int32array=function(e){this.bufferBuilder.append(qt(22)),this.pack_raw_bufferview(e)},nt.prototype.pack_float32array=function(e){this.bufferBuilder.append(qt(23)),this.pack_raw_bufferview(e)},nt.prototype.pack_float64array=function(e){this.bufferBuilder.append(qt(24)),this.pack_raw_bufferview(e)},nt.prototype.pack_dataview=function(e){this.bufferBuilder.append(qt(25)),this.pack_raw_bufferview(e)},nt.prototype.pack_string=function(e){this.bufferBuilder.append(qt(12)),this.pack_raw_string(e)},nt.prototype.pack_raw_string=function(e){this.bufferBuilder.append(e),this.bufferBuilder.append(qt(255))},nt.prototype.pack_array=function(e){this.bufferBuilder.append(qt(27)),this.pack(e.length),this.backReferences.push(e);var t;for(var n=0;n<e.length;n++){if(!(n in e)){this.bufferBuilder.append(qt(29));continue}if((t=this.backReferences.indexOf(e[n]))!=-1){this.bufferBuilder.append(qt(26)),this.pack(t);continue}this.pack(e[n])}this.backReferences.pop()},nt.prototype.pack_object=function(e){this.bufferBuilder.append(qt(28)),this.pack_raw_object(e)},nt.prototype.pack_raw_object=function(e){this.pack(Object.keys(e).length),this.backReferences.push(e);var t;for(var n in e){if(!e.hasOwnProperty(n))continue;this.pack_raw_string(n);if((t=this.backReferences.indexOf(e[n]))!=-1){this.bufferBuilder.append(qt(26)),this.pack(t);continue}this.pack(e[n])}this.backReferences.pop()},nt.prototype.pack_integer=function(e){e>=0?e<=15?this.bufferBuilder.append(qt(240|e)):Rt(e)==e?(this.bufferBuilder.append(qt(6)),this.bufferBuilder.append(qt(e))):_t(e)==e?(this.bufferBuilder.append(qt(7)),this.bufferBuilder.append(Mt(e))):St(e)==e&&(this.bufferBuilder.append(qt(8)),this.bufferBuilder.append(Et(e))):e>=-16?(e=-e-1,this.bufferBuilder.append(qt(224|e))):jt(e)==e?(this.bufferBuilder.append(qt(9)),this.bufferBuilder.append(Bt(e))):kt(e)==e?(this.bufferBuilder.append(qt(10)),this.bufferBuilder.append(Ct(e))):gt(e)==e&&(this.bufferBuilder.append(qt(11)),this.bufferBuilder.append(mt(e)))},nt.prototype.pack_double=function(e){ht(e)==e?(this.bufferBuilder.append(qt(4)),this.pack_float32(e)):(this.bufferBuilder.append(qt(5)),this.pack_float64(e))},nt.prototype.pack_uint8=function(e){this.bufferBuilder.append(uInt8ToBuffer(e))},nt.prototype.pack_uint16=function(e){this.bufferBuilder.append(uInt16ToBuffer(e))},nt.prototype.pack_uint32=function(e){this.bufferBuilder.append(uInt32ToBuffer(e))},nt.prototype.pack_int8=function(e){this.bufferBuilder.append(Bt(e))},nt.prototype.pack_int16=function(e){this.bufferBuilder.append(Ct(e))},nt.prototype.pack_int32=function(e){this.bufferBuilder.append(mt(e))},nt.prototype.pack_float32=function(e){this.bufferBuilder.append(ct(e))},nt.prototype.pack_float64=function(e){this.bufferBuilder.append(ot(e))},nt.prototype.pack_chunk=function(e){this.bufferBuilder.append(qt(30)),this.pack(e.hash),this.pack(e.start);if(e.start==0){var t=new nt;t.pack(e.metadata);var n=t.getBuffer();n.size>500?(console.warn("Warning: chunk metadata too large"),this.pack(undefined)):this.bufferBuilder.append(n),this.pack(e.total)}this.pack(e.end),this.bufferBuilder.append(e.data)};var rt=new Uint8Array(8),it=new Float64Array(rt.buffer),at=new Uint8Array(4),ft=new Float32Array(at.buffer),pt=new Uint8Array(4),dt=new Int32Array(pt.buffer),yt=new Uint8Array(4),bt=new Uint32Array(yt.buffer),xt=new Uint8Array(2),Tt=new Int16Array(xt.buffer),Lt=new Uint8Array(2),At=new Uint16Array(Lt.buffer),Dt=new Uint8Array(1),Pt=new Int8Array(Dt.buffer),Ft=new Uint8Array(1);zt.prototype.getNextChunk=function(e){if(this.complete>=1)return!1;var t=this.index,n=this.blob.slice(this.index,this.index=Math.min(this.blob.size,this.index+e));return this.complete=this.index/this.blob.size,new Ut(n,t,this.index,this.hash,this.metadata,this.blob.size)},Wt.prototype.addChunk=function(e){if(this.complete>=1)return!1;e.start==0&&(this.total=e.total,this.metadata=e.metadata);if(e.start!=this.index)return this.buffer.pointers.push(e.start),this.buffer.chunks.push(e),!0;this.result.push(e.data),this.index=e.end,this.complete=this.index/this.total,this.complete==1&&(this.result=new Blob(this.result));var t;if((t=this.buffer.pointers.indexOf(this.index))!=-1){this.buffer.pointers.splice(t,1);var n=this.buffer.chunks.splice(t,1)[0];return this.addChunk(n)}return!0};var Xt=function(){function r(e){this._cb.call(this._that,e.data)}if(!(window.requestFileSystem||window.webkitRequestFileSystem||window.mozRequestFileSystem||window.moz_requestFileSystem))return function(e,t,n){var r=n||{};return a.after(0,t,r,[new Blob([e])]),r};var e=URL.createObjectURL(new Blob(['self.requestFileSystemSync = self.webkitRequestFileSystemSync|| self.moz_requestFileSystemSync|| self.mozRequestFileSystemSync|| self.requestFileSystemSync;requestFileSystemSync(TEMPORARY,500).root.getDirectory(".BinaryPack",{create: true}).removeRecursively();self.close();'],{type:"text/javascript"})),t=URL.createObjectURL(new Blob(['self.onmessage = function(e){var b = new Blob([e.data]);self.requestFileSystemSync = self.webkitRequestFileSystemSync|| self.moz_requestFileSystemSync|| self.mozRequestFileSystemSync|| self.requestFileSystemSync;var file = 	requestFileSystemSync(TEMPORARY,b.size + 500).root.getDirectory(".BinaryPack",{create: true}).getFile(Date.now().toString(),{create: true});file.createWriter().write(b);postMessage(file.file());self.close();};'],{type:"text/javascript"})),n=new Worker(e);return URL.revokeObjectURL(e),function(e,n,i){var s=new Worker(t);return s.onmessage=r,s._cb=n,s._that=i||s,s.postMessage(e,[e]),s}}(),Vt=function(){var e=URL.createObjectURL(new Blob([""],{type:"text/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}();e.BinaryPack={after:a.after.bind(a),getBlob:Xt,Chunker:zt,Joiner:Wt,free:$t,isChunk:function(e){return e instanceof Ut},unpack:function(e,t){var n=new f(e);n.unpack(t)},maxRAM:1e3,pack:function(e){var t=new nt;t.pack(e);var n=t.getBuffer();return n}}})(this)